
# 1. 概述

[oracle官方文档](https://docs.oracle.com/cd/E56344_01/html/E54077/makehtml-id-0.html#scrolltoc)

# 2. 说明

单个字母的参数，带有参数的选项

- `[ ]` 方括号。括在方括号中的选项或参数是可选的。如果没有方括号，则必须指定参数。
- . . .省略号。可以为该符号前面的参数提供多个值，或者可以多次指定该参数，例如 “filename . . .”。
- | 分隔符。一次只能指定一个由该字符分隔的参数
- { }花括号。括在大括号内的选项和/或参数是相互依赖的，因此必须将大括号中的所有内容视为一个单元。

语法的例子：

`name [option(s)] [cmdarg(s)]`
其中：

```vim
name
  可执行文件的名称。

option
  − noargletter(s) 或

  − argletter< >optarg

  其中 < > 是可选空格。

    noargletter
        表示不带参数的选项的单个字母。

    argletter
        表示需要参数的选项的单个字母。

    optarg
        符合前面的 argletter 的参数（字符串）。

    cmdarg
        不是以 − 开头的或者 − 本身表示标准输入的路径名（或其他命令参数）。

```
# 3. zpool

每个池都有多个关联的属性。有些属性是只读的统计信息，而其他属性是可配置的，可以改变池的行为。以下是只读属性：

## 3.1. 只读

序号|参数（属性）|description|默认值
---|---|---|---
1  |allocated   | 池中已实际分配的存储空间量。该属性也可通过其简短列名 alloc 来引用。|
2  |capacity    |已用的池空间百分比。此属性也可通过其简短列名 cap 来引用。
3  |dedupratio  |为池指定的重复数据删除比率，用乘数因子表示。该值用一个十进制数表示。例如，dedupratio 值 1.76 表示存储了 1.76 个单位的数据，但实际消耗的磁盘空间只有 1 个单位。该属性也可通过其简短列名 dedup 来引用。可按如下方式启用重复数据删除<br>`# zfs set dedup=on pool/dataset` <br>缺省值为 off（关闭）。有关重复数据删除功能的说明，请参见 zfs(1M)。|off，**重点关注？？？**
4  |free        |池中未分配的块的数量。
5  |guid        |池的唯一标识符。可用zpool get guid获得
6  |health      |池的当前运行状况。运行状态可以是 ONLINE、DEGRADED、UNAVAIL 或 SUSPENDED。
7  |size        |存储池的总大小。<br>这些空间使用属性报告存储池的实际可用物理空间。物理空间可能与空间总量不同，后者是所有包含的数据集可以实际使用的空间量。raidz 配置中使用的空间量取决于写入的数据的特征。此外，ZFS 会保留一些空间用于内部记帐，_【zfs(1M) 命令会考虑这一点，但 zpool 命令则不会】（啥意思？？？？）_。对于合理大小的未满池，应该看不出这些影响。对于小型池，或者接近全满的池，这些差异可能会变得更加明显。

## 3.2. 可设置

以下属性可在**创建或导入时**设置：

序号|参数（属性）|description|默认值|建议值
---|---|---|---|---
1  |altroot  |备用根目录。如果进行了设置，则该目录会被前置到池中的任何挂载点。检查未知池（无法信任其中的挂载点）时，或在典型路径无效的备用启动环境中，可以使用此属性。altroot 不是持久属性。它仅在系统运行期间有效。设置 altroot 即表示缺省情况下使用 cachefile=none，但此设置可以使用显式设置来覆盖。||**重点关注，没弄明白是什么？？？**

以下属性可在导入时设置：

序号|参数（属性）|description|默认值|建议值
---|---|---|---|---
1  |readonly=on \| off   | 控制是否可以修改池。启用后，在以读写模式导入池之前，任何仅存在于**意图日志中**的同步数据都不可访问。<br>以只读模式导入池具有以下限制：<br>- 导入期间试图设置其他池属性将被忽略。<br>- 所有文件系统挂载都将转换为包括只读 (ro) 挂载选项。<br>通过导出和导入池可将已以只读模式导入的池恢复为读写模式|**没明白**？？？？

以下属性可在创建时和导入时设置，并可在以后使用 zpool set 命令更改：

序号|参数（属性）|description|默认值|建议值|备注
---|---|---|---|---|---
1  |autoexpand=on \| off  | 在底层 LUN(_LUN是什么？？？_)) 增长时控制自动池扩展。如果设置为 on，池将根据扩展设备的大小重新调整大小。如果设备是某个镜像或 raidz 的一部分，则在新空间对池可用之前，该镜像/raidz 组内的所有设备都必须扩展。缺省行为为 off。_该属性也可通过其简短列名 expand（扩展）来引用（啥意思？？？）_。|off| | _不是很明白，on会比较好吧？？？_
2  |autoreplace=on \| off |控制设备的自动替换。如果设置为 off（关闭），则必须由管理员使用 zpool replace 命令来启动设备替换。如果设置为 on（打开），则会自动对与**先前属于池的设备在同一物理位置的任何新设备**（意思时在服务器同一个位置还一块磁盘）进行格式化和替换。缺省行为为 off。此属性也可通过其简短列名 replace 来引用。| off | |on(再考虑以下？？？)
3  |bootfs=pool/dataset   | 标识 根池 的缺省可引导数据集。此属性应主要通过安装和升级程序设置。| - | |_看不懂是什么？？？_
4  | cachefile=path \| none |控制高速缓存池配置的位置。要在系统启动时发现所有池，需要存储在根文件系统上的配置数据的高速缓存副本。系统引导时会自动导入此高速缓存中的所有池。有些环境（如安装和群集）需要将此信息高速缓存在其他位置，从而使池不会被自动导入。设置此属性后，池配置将高速缓存在其他位置，以后可以使用 zpool import -c 将其导入。如果将其设置为特殊值 none（无），将创建一个永远不会高速缓存的临时池；如果设置为特殊值 ''（空字符串），则将使用缺省位置。<br>多个池可以共享同一个高速缓存文件。因为在添加或移除池时，内核会销毁并重新创建此文件，因此在试图访问此文件时应小心。在导出或销毁了最后一个使用 cachefile 的池后，将删除该文件。|-| | 无关，先不用考虑
5  | dedupditto=number | 设置副本数的阈值。如果某个消重后的块的引用数超过了此阈值，将自动存储该块的另一个相同副本。缺省值为 "0"。<br>_我的理解的阈值就是说副本的个数不能超过阈值，但是这句话实在不理解什么意思_| 0 |  | _不知道设置为多少合适_，不清楚有什么作用，不知道怎么模拟
6  |delegation=on \| off  |控制是否根据在数据集上定义的数据集权限授予非特权用户访问权。缺省值为 on| on
7  |failmode=wait \| continue \| panic   |控制在出现灾难性池故障时的系统行为。这种情况通常是由于失去与基础存储设备的连接或池中所有设备出现故障而导致的。此类事件的行为按以下方式确定：<br><br>**- wait**:阻止对池的所有 I/O 访问，直到恢复设备连接并清除错误。在设备问题得到解决之前，池一直处于 wait 状态。这是缺省行为。<br><br>**- continue**:使 EIO 返回到任何新的写入 I/O 请求，但允许对其余任何运行状况良好的设备执行读取操作。将会阻止必须提交到磁盘的任何写入请求。<br><br>**- panic**:向控制台输出一则消息，并生成一个系统故障转储（_系统故障转储是什么意思？？？，是log之类的存档吗？？？？_）。| wait| |感觉用wait就可以，或者用continue
8  |  listshares=on \| off | 控制使用 zfs list 命令是否可显示此池中的共享信息。缺省值为 off（关闭）。|off | |感觉off或者on无关紧要，并且zpool get 不到此属性
9  | listsnaps=on \| off | 控制在不使用 –t 选项运行 zfs list 时，是否输出与该池关联的快照的相关信息。缺省值为 off（关闭）。| off | | 尝试打开了，但是感觉zfs list也没输出个啥 
10 |version=version        |池的当前盘上版本。此版本可以提高，但绝不能降低。尽管在为了实现向后兼容性而需要一个特定版本时可以使用此属性，但首选的池更新方法是使用 zpool upgrade 命令。此属性可以是 1 与 zpool upgrade -v 所报告的当前版本之间的任何数值。|-| |_池的版本怎么控制，有什么作用？？？_

# 4. zfs属性配置

属性分为两种类型：**本机属性和用户定义的（或用户）属性**。<span style="border-bottom:2px dashed red;">本机属性用于提供内部统计信息或控制 ZFS 行为</span>。此外，本机属性分为**可编辑属性和只读属性**。用户属性对 ZFS 行为没有影响，<span style="border-bottom:2px dashed red;">但可通过用户环境中有意义的方式来**注释数据集**。

**每个数据集都有一组属性**，用于提供有关数据集的统计信息并控制各种行为。属性继承自父项，但子项所覆盖的除外。有些属性仅适用于某些类型的数据集（文件系统、卷或快照）。

# 5. 本机属性

**只读属性**：

序号|参数|description|默认值|建议值|备注
---|---|---|---|---|---
1 |available     |数据集及其所有子项的可用空间的数量（假定池中没有其他活动）。由于池中会共享空间，因此可用空间会受到许多因素的限制，包括物理池大小、配额、预留空间或池中的其他数据集| |
2 |compressratio | 为此数据集实现的压缩率，以倍数形式表示。通过运行 zfs set compression=on dataset 可以启用压缩。缺省值为 off（关闭）。| off ||_需要着重考虑如何设置？？？_
3 |creation      |创建此数据集的时间
4 |defer_destroy |如果已使用 zfs destroy –d 命令将快照标记为延期销毁，则此属性为 on。否则，此属性为 off。|||是不是得设置个时间来延迟删除快照
5 |keychangedate |有关更多信息，请参见 zfs_encrypt(1M)。
6 |keystatus     |有关更多信息，请参见 zfs_encrypt(1M)。
7 |mounted       |对于文件系统，指示当前是否已挂载文件系统。此属性可以是 yes 或 no。
8 |origin        |对于克隆的文件系统或卷，指示创建克隆时所基于的快照。只要克隆存在，便不能销毁克隆源（即使使用 –r 或 –f 选项也是如此）。
10|referenced    |此数据集可访问的数据量，【这些数据可以与池中其他数据集共享，也可以不与其他数据集共享】（_搞不明怎么个共享？？？？）_。创建快照或克隆时，首先会**引用**与创建时所基于的文件系统或快照相同的空间量，因为其内容相同[_不明白啥意思？？？】_。<br>此属性也可通过其简短列名 refer 来引用。    |
11|rekeydate     |有关更多信息，请参见 zfs_encrypt(1M)。
12|type          |数据集类型：filesystem、volume 或 snapshot。
13 |used         |此数据集及其所有后代**占用**的空间量。这是根据此**数据集的配额和预留空间**进行检查的值。使用的空间不包括此数据集的预留空间，但是会考虑 refreservation（通过 usedbyrefreservation）以及任何后代数据集的预留空间（通过 usedbychildren）。数据集占用其父项的空间量以及以递归方式销毁此数据集时所释放的空间量，应为其使用空间和预留空间的较大者。<br><br>【创建快照时（请参见“快照”一节），其空间最初将在快照与文件系统之间共享，也可能与以前的快照共享。随着文件系统的变化，以前共享的空间将供快照专用】（_共享 专用，怎么个共享法，怎么个专用法？？？_），并会计算在快照的使用空间内。此外，删除快照可增加其他快照专用（和使用）的空间量。<br><br>使用的空间量、可用的空间量或引用的空间量不会考虑暂挂更改。通常，暂挂更改仅占用几秒钟的时间。使用 fsync(3C) 或 O_SYNC 提交对磁盘的更改，不一定可以保证空间使用情况信息会立即更新。
14 |usedby*     |usedby* 属性将 used 属性分解为使用该空间的各种原因。具体而言，**used = usedbychildren + usedbydataset + usedbyrefreservation + usedbysnapshots**。这些属性只能用于在版本 13 或更高版本的池上创建的数据集。
15 |usedbychildren |此数据集的子项使用的空间量，如果销毁此数据集的所有子项，将释放该空间。
16 |usedbydataset  |此数据集本身使用的空间量，如果销毁此数据集，将释放该空间（首次删除任何 refreservation 并销毁任何必需的快照或后代之后）。
17 |usedbyrefreservation |针对此数据集设置的 refreservation 占用的空间量，如果删除 refreservation，将释放该空间。<br><br>此属性所占用的空间表示未来写操作可能消耗的空间，预留以防此数据集出现写分配故障。这可能包括未写入的数据、当前与快照共享的空间，以及卷的压缩节省空间（当用更少的可压缩数据替换时可能丢失）。当为后续写操作分配空间增加 usedbydataset 或 usedbysnapshots 时，将相应减少 usedbyrefreservation。
18 |usedbysnapshots|此数据集的快照占用的空间量。特别地，此空间量是销毁此数据集的所有快照后将释放的空间量。请注意，此空间量不是快照的 used 属性的简单总和，因为空间可被多个快照共享（_到底怎么个共享法？？？）_。
19 |userused@user|此数据集中指定的用户占用的空间量。空间由每个文件的所有者占用，如 ls –l 显示的内容所示。占用的空间量由 du 和 ls –s 显示。有关更多信息，请参见 zfs userspace 子命令。<br><br>未授权的用户只能访问各自的空间使用情况。root 用户或已用 zfs allow 授予 userused 特权的用户，可以访问每个人的空间使用情况。<br><br>zfs get all 不会显示 userused@... 属性。必须使用以下形式之一在 @ 符号后加上用户名：<br><br>- POSIX name（例如 joe）<br><br>- POSIX numeric ID（例如 789）<br><br>-SID name（例如 joe.smith@mydomain）<br><br>- SID numeric ID（例如 S-1-123-456-789）|||暂时不搞多用户
20 |userrefs   |为此快照上的用户保留量可设置此属性。通过使用 zfs hold 命令可设置用户保留量。
21 |groupused@group|此数据集中指定的组占用的空间量。空间由每个文件的组所占用，如 ls –l 显示的内容所示。有关更多信息，请参见 userused@user 属性。<br><br>未授权的用户只能访问各自的组的空间使用情况。root 用户或已用 zfs allow 授予 groupused 特权的用户，可以访问所有组的空间使用情况。|||
22 |volblocksize=blocksize|可为卷指定卷的块大小。在写入卷后无法更改 blocksize，因此应在创建卷时设置该值。卷的缺省 blocksize 是 8 KB。范围位于 512 字节到 1 MB 之间的 2 的任意次幂都有效。|-|||

**可配置属性**：

序号|参数|description|默认值|建议值|备注
---|---|---|---|---|---
1  |aclmode=discard \| mask \| passthrough|  控制 chmod(2) 执行期间如何修改 ACL(_啥意思？？？_）。<br><br>带有 aclmode 属性 discard（缺省值）的文件系统删除不表示**文件模式**的所有 ACL 条目。<br><br>aclmode 属性 mask 减少用户或组的权限。除非用户项与文件或目录的属主具有相同的 UID，否则将减少权限，以使其不会大于组权限位。在这种情况下，减少 ACL 权限，以使其不会大于所有者权限位。mask 还跨模式更改保留 ACL（两次模式更改之间没有进行显式 ACL 设置 [通过 chmod(1)]）。<br><br>带有 aclmode 属性 passthrough 的文件系统指示除了生成必要的 ACL 条目来表示文件或目录的新模式以外，不会对 ACL 进行其他更改|  discard||_暂时想不明白设置成什么好？？？_|
2  |aclinherit=discard \| noallow \| restricted \| passthrough \| passthrough-x|控制创建文件和目录时继承 ACL 项的方法。<br>aclinherit 属性为 discard 的文件系统不继承任何 ACL 项。<br>aclinherit 属性值为 noallow 的文件系统仅继承指定了“拒绝”权限的可继承 ACL 项。<br><span style="border-bottom:2px dashed red;">在继承 ACL 项时，属性值 restricted（缺省值）会删除 write_acl 和 write_owner 权限</span>。<br>如果文件系统的 aclinherit 属性值为 passthrough，则会继承所有可继承的 ACL 项，并且继承 ACL 项时不会对其进行任何修改。如果文件系统的 aclinherit 属性值为 passthrough-x，则与 passthrough 具有同样的意义，区别在于仅当文件创建模式也需要执行位时，所有 ACE 均继承执行权限。<br><br>当属性值设置为 passthrough 时，将使用由可继承的 ACE 确定的模式来创建文件。如果不存在影响模式的可继承 ACE，则会根据应用程序请求的模式设置模式。|restricted||_暂时还没对acl做调研_
3  |atime=on \| off   |控制文件**被读取后**是否更新该文件的访问时间。<span style="border-bottom:2px dashed red;">禁用该属性可避免在读取文件时产生写入流量(_这个我就不懂了???什么叫读时产生写入流量？？？_），因此可显著提高性能</span>，但可能会使邮件程序与其他相似的实用程序感到困惑。缺省值为 on。|on ||_得慎重考虑是on还是off？？？_
4  |canmount=on \| off \| noauto  |  如果此属性设置为 off，则**无法挂载文件系统**，并且 zfs mount -a 将忽略此文件系统。将此属性设置为 off 与将 mountpoint 属性设置为 none 的效果相似，区别在于数据集仍有一个可继承的正常 mountpoint 属性。通过将此属性设置为 off，可以将数据集单独用作一种继承属性的机制。例如，设置 canmount=off 将使两个数据集具有相同的 mountpoint，因此两个数据集的子项会出现在同一个目录中，但是可能具有不同的继承特征。<br><br>设置 noauto 选项时，只能显式挂载和卸载数据集。数据集不会在创建或导入时自动挂载，也不能通过 zfs mount -a 命令挂载或通过 zfs unmount -a 命令卸载。<br><br>不会继承此属性   |on| |模前觉着还是on合适|
5  |checksum=on \| off \| fletcher2,\| fletcher4 \| sha256 \| sha256+mac|控制用于验证数据完整性的校验和。缺省值是 on，它将自动选择正确的算法（当前为 fletcher4，但是在将来的版本中可能改变）。值为 off 将禁止对用户数据进行完整性检查。<span style="border-bottom:2px dashed red;">实际操作中建议不要禁用校验和</span>。<br><br>更改此属性只会影响新写入的数据。<br><br>只有在启用加密时，值 sha256+mac 才可用。在启用加密时，校验和属性变为 readonly，然后始终将其设置为 sha256+mac。|on| on|
6  | compression=on \| off \| lzjb \| gzip \| gzip- N \| zle |控制用于此数据集的压缩算法。在提供适当的数据压缩时，将为 lzjb 压缩算法优化性能。**将压缩设置为 on 会使用 lzjb 压缩算法**。gzip 压缩算法使用与 gzip (1) 命令相同的压缩。<span style="border-bottom:2px dashed red;">通过使用值 gzip-N 可以指定 gzip 级别，其中 N 是一个从 1（最快）至 9（最佳压缩率）的整数。当前，gzip 等效于 gzip-6（这也是 gzip (1) 的缺省值）</span>。<br><br>该属性也可通过其简短列名 compress 来引用。更改此属性只会影响新写入的数据。|off||_考虑下到底要不要压缩，暂时觉着一开始还是不要？？？_
7  | copies=1 \| \2 \| 3 |控制为此数据集存储的数据副本数量。这些副本是对池提供的任何冗余（例如镜像或 RAID-Z）的补充。<span style="border-bottom:2px dashed red;">这些副本将存储在不同的磁盘上（如果可能）</span>。【多个副本使用的空间由相关联的文件和数据集占用，按照配额和预留空间更改 used 属性和计算方式】（_看着不是很明白？？？_）。<br><br>更改此属性只会影响新写入的数据。因此，在创建文件系统时通过使用 -o copies=N 选项设置此属性。<br><br>在数据集上启用加密时，可设置的最大副本数量是 2。| 1 ||_暂时就不要设置副本了吧？？？_ 以后根据需要在设置|
8  |dedup=on \| off \| verify \| sha256[,verify ] | _【控制重复数据删除对数据集是否有效】（这几话不是很理解，意思是去检测和确定数据集的重复数据是否可以删除吗？？？）_。缺省值为 off（关闭）。用于重复数据删除的缺省校验和是 sha256（可能会更改）。在启用 dedup 时，dedup 校验和算法会覆盖 checksum 属性。将值设置为 verify 等效于指定 sha256,verify。<br><br>如果将属性设置为 verify，则只要两个块具有**相同的签名**(_不明白块的签名是什么，暂时没查到？？？_），ZFS 都会与现有块进行逐字节比较，以确保内容完全相同。| off ||**这个得好好考虑一下，暂时觉着开启比较好**|
9  | devices=on \| off |控制是否可在此文件系统中打开设备节点（_设备节点是个什么玩意？？？_）。缺省值为 on。|on|on|我认为得开启，保持默认就好
10 | exec=on \| off| 控制是否可从此文件系统中执行进程。缺省值为 on| on | on
11 | logbias = latency \| throughput | 控制 ZFS 如何为此数据集优化**同步请求**。如果 logbias 设置为 latency，ZFS 将使用池的不同日志设备（如有）低延迟地处理请求。如果 logbias 设置为 throughput，ZFS 将不使用池的不同日志设备。相反，ZFS 将优化同步操作，以提高池的全局吞吐量并有效使用资源。缺省值为 latency。|latency |latency|_暂时没有配置日志设备吧？？？？_
12 |mlslabel=label \| none| 有关多级别文件系统中 mlslabel 属性行为的描述，请参见 multilevel 属性。下面的 mlslabel 描述适用于非多级别文件系统<br><br>mlslabel 属性是一个敏感标签，用于确定能否在启用了 【Trusted Extensions】(_知识盲区？？？_) 的系统的区域中挂载数据集。如果有标签的数据集与有标签的区域相符，则可以从有标签的区域挂载和访问数据集。<br><br>如果未设置 mlslabel 属性，缺省值将为 none。将 mlslabel 属性设置为 none 等效于删除该属性。<br><br>只有在启用了 Trusted Extensions 并且具有相应的特权时，才能修改 mlslabel 属性。不可委托用于修改此属性的权限。将标签更改为较高级别标签或设置初始数据集标签时，需要 {PRIV_FILE_UPGRADE_SL} 特权。将标签更改为较低级别标签或缺省标签 (none) 时，需要 {PRIV_FILE_DOWNGRADE_SL} 特权。只有在未挂载数据集时，才能将数据集更改为缺省值以外的标签。将具有缺省标签的数据集挂载到有标签区域时，挂载操作会自动将 mlslabel 属性设置为该区域的标签。<br><br>如果未启用 Trusted Extensions，则只能挂载具有缺省标签 (none) 的数据集。|none|none|暂时设置成none吧，_但是有必要深入看看这一块相关知识_？？？
13 |mountpoint=path \| none \| legacy| 控制用于此文件系统的挂载点。有关如何使用此属性的更多信息，请参见“挂载点”一节。<br><br>当文件系统的 mountpoint 属性发生更改时，将卸载该文件系统以及继承挂载点的任何子项。如果新值为 legacy，则该文件系统和子级将保持卸载状态。否则，如果属性以前为 legacy 或 none，或者该文件系统和子级在属性发生更改之前处于挂载状态，则会自动在新位置重新挂载它们。此外，任何共享文件系统都将取消共享，并在新位置进行共享。|||个人觉着不用配置此项
14 |nbmand=on | off|有关更多信息，请参见 zfs_share(1M)。|||_有待深入调查？？？_
15 |primarycache=all \| none \| metadata | 控制在**主高速缓冲存储器 (ARC) 中缓存的内容**(_我们是不是用不到告诉缓冲存储器，ARC是什么东西？？？_）。如果将此属性设置为 all，则会高速缓存用户数据和元数据。如果将此属性设置为 none，则不会高速缓存用户数据和元数据。如果将此属性设置为 metadata，则只会高速缓存元数据。缺省值为 all。|all |all| 个人觉着暂时不用修改
16 |quota=size \| none|限制数据集及其后代可占用的空间量。此属性对使用的空间量强制实施硬限制。这包括后代（含文件系统和快照）占用的所有空间。对已有配额的数据集的后代设置配额不会覆盖祖先的配额，但会施加额外的限制。<br><br>不能对卷设置配额，因为 volsize 属性可用作隐式配额。
17 |quota=size \| none|限制数据集及其后代可占用的空间量。此属性对使用的空间量强制实施硬限制。这包括后代（含文件系统和快照）占用的所有空间。对已有配额的数据集的后代设置配额不会覆盖祖先的配额，但会施加额外的限制。<br><br>(不能对卷设置配额，因为 volsize 属性可用作隐式配额。)|none| none |_跟人觉着不用设置？？？_
18 |sync=standard \| always \| disabled |确定文件系统事务的同步程度。在创建数据集时可设置此属性，也可动态设置此属性，并且属性将会立即生效。此属性可能具有以下设置之一：<br><br>-standardL: 缺省选项。将同步文件系统事务写入到意图日志，然后刷新写入的所有设备，以确保数据稳定（即设备控制器未进行高速缓存） <br><br>- always: 将每个文件系统事务写入到稳定的存储器中并刷新。此值对性能具有重大不利影响，但是适合为同步文件系统事务排除故障。 <br><br>- disabled: 禁用同步请求。仅当下一次提交 DMU 事务组时，文件系统事务才会提交至稳定的存储器，这可能会延迟好几秒钟。此设置提供最高性能。但是，这是非常危险的，因为 ZFS 会忽略应用程序的同步事务要求，例如数据库或 NFS。而且，当此设置对当前活动的根或 /var 文件系统生效时，可能导致行为不合规范、应用程序数据丢失以及增加反复攻击的漏洞。管理员只应在了解这些风险时才使用此选项 | standard | |_这个配置涉及到意图日志，我们是不是不会用到日志设备，所以这个选项是不是暂时可以考虑此配置？？？_
19 |userquota@user= size \| none| 限制指定的用户占用的空间量。与 refquota 属性相似，计算 userquota 空间不包括后代数据集（例如快照和克隆）使用的空间。用户空间占用由 userspace@user 属性标识。<br><br>用户配额的实施可能会延迟几秒钟。这种延迟意味着在系统注意到用户超出配额前，用户可以超出其配额。系统然后会开始拒绝额外的写入内容，并提示 EDQUOT 错误消息。有关更多信息，请参见 zfs userspace 子命令。 <br><br>未授权的用户只能访问各自的组的空间使用情况。root 用户或已用 zfs allow 授予 userquota 特权的用户，可以获取和设置每个人的配额 <br><br> 对于卷、第 4 版以前的文件系统或第 15 版以前的池，此属性均不可用。zfs get all 不会显示 userquota@... 属性。必须使用以下形式之一在 @ 符号后加上用户名：<br>-POSIX name（例如 joe） <br>-POSIX numeric ID（例如 789 <br>-SID name（例如 joe.smith@mydomain）<br>- SID numeric ID（例如 S-1-123-456-789）|||_关于多用户，个人觉着暂时可以略过，不做过多配置？？？_
20 | groupquota@group= size \| none| 限制指定的组占用的空间量。组空间占用由 userquota@ user 属性标识。<br><br>未授权的用户只能访问各自的组的空间使用情况。root 用户或已用 zfs allow 授予 groupquota 特权的用户，可以获取和设置所有组的配额|||_用户组？？？_
21 | readonly=on \| off| 控制是否可以修改此数据集。缺省值为 off（关闭），可以修改。<br><br>此属性也可通过其简短列名 rdonly 来引用。|off|off|个人觉着应该配置成off
22 |recordsize=size|为文件系统中的文件指定建议的块大小。【该属性专门设计用于对大小固定的记录中的文件进行访问的数据库工作负荷】（_这句话读不明白？？？_）。<span style="border-bottom:2px dashed red;">ZFS 会根据为典型的访问模式优化的内部算法来自动调整块大小</span>。<br><br>对于创建很大的文件但访问较小的随机块中的文件的数据库而言，这些算法可能不是最优的。<span style="border-bottom:2px dashed red;">将 recordsize 指定为大于或等于数据库的记录大小的值可以显著提高性能。强烈建议不要将该属性用于一般用途的文件系统，否则可能会对性能产生不利影响</span>。<br><br>缺省 recordsize 是 128 KB。指定的大小必须是 2 的若干次幂，并且必须大于或等于 512 字节同时小于或等于 1 MB。<br><br>更改文件系统的 recordsize 只影响以后创建的文件，现有文件和接收的数据不受影响。<br><br>此属性也可通过其简短列名 recsize 来引用。|128k||_raptor块大小64m,这个地方有没有必要配置成其他的值来显著提高性能呢？？？？_
23 | refquota=size \| none  |限制数据集可以占用的空间量。此属性对使用的空间量强制实施硬限制<span style="border-bottom:2px dashed red;">。这种硬限制不包括后代以及文件系统和快照使用的空间。</span>| none| none |_个人觉着暂时不用设置？？？_
24 |refreservation=size \| none | 为数据集（不含其后代）预留的最小空间量。如果 usedbydataset 空间低于此值，则认为数据集正在使用 refreservation 指定的空间量。usedbyrefreservation 数字表示该额外空间，并添加到数据集占用的总 used 空间，继而占用父数据集的用量、配额和预留空间。这将通过确保提前预留用于未来写操作的空间，防止数据集过度承载池资源。<br><br>此属性也可通过其简短列名 reserv 来引用。|none||_个人觉着暂时也可以不用配置？？？_
25 | rstchown=on \| off   |指示文件系统是否通过 chown(1) 或 chown(2) 系统调用来限制用户放弃其文件。缺省值是限制 chown。如果 rstchown 为 off，则 chown 的行为将如同用户具有 PRIV_FILE_CHOWN_SELF 特权一样。|||_奇怪，测试时并没有找到此属性？？？_
26 | secondarycache=all \| none \| metadata | 控制在**二级高速缓存 (L2ARC**) （_这是啥？？？_）中缓存的内容。如果将此属性设置为 all，则会高速缓存用户数据和元数据。如果将此属性设置为 none，则不会高速缓存用户数据和元数据。如果将此属性设置为 metadata，则只会高速缓存元数据。缺省值为 all。|all | |_疑惑，到底用没有到缓存？？？_
27 | setuid=on \| off |控制文件系统是否遵照 set-UID 位。缺省值为 on。|on | on |_个人觉着应该是设置成on_
28 | shadow=URI \| none  | 将 ZFS 文件系统视为 URI 描述的文件系统的影子。设置该属性时，数据从 URI 标识的文件系统迁移到影子文件系统。将迁移的文件系统必须为只读才能进行完整迁移。<br><br> 对影子文件系统中尚未迁移的目录的访问会被阻止，直到迁移了整个目录。对影子文件系统中尚未迁移的文件进行访问将导致只迁移被访问文件的一部分。多个进程可以同时迁移一个文件的不同部分。<br><br> 接受两种格式的 URI，一种用于将本地文件系统迁移到同一物理系统上的其他文件系统，另一个用于从 NFS 服务器远程迁移文件系统。这两种格式为：<br>file:///path<br>nfs://host/path <br><br>如果迁移完成时 shadowd(1M) 仍在运行，则文件系统将自动重新挂载（影子属性设置为 none）。或者，迁移完成时，您可以手动将影子属性设置为 none。|none ||_这是个大的知识点，需要深入？？？_
29 | sharenfs=on \| off | 有关更多信息，请参见 [zfs_share(1M)](https://docs.oracle.com/cd/E56344_01/html/E54077/zfs-share-1m.html#REFMAN1Mzfs-share-1m)。
30 | sharesmb=on \| off | 有关更多信息，请参见 zfs_share(1M)。
31 | snapdir=hidden \| visible| 按照“快照”一节的讨论，控制在文件系统的根中是否隐藏或显示 .zfs 目录。缺省值为 hidden。|hidden | hidden|
32 | version=1 \| 2 \| current | 此文件系统的盘上版本，与池版本无关。只可以为后续支持的版本设置此属性。设置 zfs upgrade 命令。|||_不清楚他倒底有什么作用？？？_，个人觉着暂时可以不用配置
33 | volsize=size |指定卷的逻辑大小。缺省情况下，创建卷将建立稍大于实际逻辑卷大小的 refreservation，以用于 ZFS 源数据开销。对 volsize 的任何更改都会反映为对 refreservation 的等效更改。volsize 只可以设置为多个 volblocksize，并且不能为零。<br><br>在卷上设置 refreservation，以防止使用者的意外行为。如果没有预留空间，则卷可能用完空间，导致不明确的行为或数据损坏，具体取决于卷的使用方式。如果在卷的使用过程中（特别是在缩减大小时）更改卷大小，也会出现上述影响。**调整卷大小时，需要格外小心**。<br><br>可以通过指定 zfs create -V 命令的 –s 选项来创建稀疏卷（也称为瘦置备），但并不建议这样做。稀疏卷是预留空间小于卷大小的卷。因此，当池空间不足时，对稀疏卷的写操作可能因 ENOSPC 而失败。对于稀疏卷，预留空间中不会反映对 volsize 的更改。|- |-|_关于“卷”，我们没用到吧？？？_，卷只在特殊情况下使用？？？
34 | vscan=on \| off   |有关更多信息，请参见 zfs_share(1M)。
35 |xattr=on \| off    | 控制是否为此文件系统启用**扩展属性**（_扩展属性是什么？？？_）。缺省值为 on。
36 |zoned=on \| off    |控制是否从非全局区域管理数据集。有关更多信息，请参见“区域”一节。缺省值为 off（关闭）。

在创建文件系统后无法更改以下属性，因此**在创建文件系统时应设置这些属性**。如果未使用 zfs create 或 zpool create 命令设置属性，则从父数据集继承这些属性。如果在这些功能获得支持以前已创建的父数据集缺少这些属性，则新文件系统将为这些属性采用缺省值。

序号|参数|description|默认值|建议值|备注
---|---|---|---|---|---
1  |casesensitivity=sensitive \| insensitive \| mixed
2  |normalization = none \| formC \| formD \| formKC \| formKD
3  |utf8only=on \| off
4  |encryption=off \| on \| aes-128-ccm \| aes-192-ccm \| aes-256-ccm \| aes-128-gcm \| aes-192-gcm \| aes-256-gcm
5  |multilevel=on \| off
6  |keysource=raw \| hex \| passphrase,prompt \| file

# 其他指点汇总

## ACL

[参考待整理](http://c.biancheng.net/view/3120.html)

## 5.1. 疑惑

使用export可能会遇到 busy无法umout情况

共享 共享 到底怎么个共享法

是不是得学习下多用户相关的系统配置方式,多用户怎么创建，属性怎么搞之类的

关于zfs_share得学习一下